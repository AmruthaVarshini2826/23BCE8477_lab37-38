<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Employee Management (XML CRUD)</title>
    <style>
        body { font-family: sans-serif; background: #f8f9fa; padding: 20px; }
        .container { max-width: 900px; margin: auto; background: white; padding: 25px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .form-group { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 20px; }
        input { padding: 10px; border: 1px solid #ddd; border-radius: 4px; }
        button { padding: 10px; cursor: pointer; border: none; border-radius: 4px; color: white; }
        .btn-add { background: #28a745; grid-column: span 4; }
        .btn-save { background: #ffc107; color: black; display: none; grid-column: span 4; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 12px; border: 1px solid #ddd; text-align: left; }
        th { background: #f1f1f1; }
        .actions button { margin-right: 5px; padding: 5px 10px; }
        .btn-edit { background: #007bff; }
        .btn-del { background: #dc3545; }
        #msg { padding: 10px; margin-bottom: 15px; border-radius: 4px; display: none; text-align: center; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
<div class="container">
    <h2>Employee Directory</h2>
    <div id="msg"></div>
    <div class="form-group">
        <input type="text" id="empId" placeholder="ID">
        <input type="text" id="empName" placeholder="Name">
        <input type="text" id="empDept" placeholder="Department">
        <input type="number" id="empSalary" placeholder="Salary">
        <button class="btn-add" onclick="createEmployee()">Add Employee</button>
        <button class="btn-save" id="saveBtn" onclick="saveUpdate()">Update Employee</button>
    </div>
    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Dept</th>
                <th>Salary</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody id="empTable"></tbody>
    </table>
</div>
<script>
    let xmlDoc = null;
    let currentEditId = null;
    function loadEmployees() {
        const xhr = new XMLHttpRequest();
        xhr.open("GET", "employees.xml", true);
        xhr.onload = function() {
            if (xhr.status === 200) {
                xmlDoc = xhr.responseXML;
                if (!xmlDoc || xmlDoc.getElementsByTagName("parsererror").length > 0) {
                    showMsg("Error: Malformed XML file", "error");
                    return;
                }
                displayTable();
            } else {
                showMsg("Error loading XML: " + xhr.status, "error");
            }
        };
        xhr.onerror = () => showMsg("Network Error", "error");
        xhr.send();
    }
    function displayTable() {
        const tableBody = document.getElementById("empTable");
        tableBody.innerHTML = "";
        const employees = xmlDoc.getElementsByTagName("employee");
        if (employees.length === 0) {
            tableBody.innerHTML = "<tr><td colspan='5' style='text-align:center'>No records found</td></tr>";
            return;
        }
        for (let i = 0; i < employees.length; i++) {
            const id = employees[i].getElementsByTagName("id")[0].textContent;
            const name = employees[i].getElementsByTagName("name")[0].textContent;
            const dept = employees[i].getElementsByTagName("dept")[0].textContent;
            const salary = employees[i].getElementsByTagName("salary")[0].textContent;
            tableBody.innerHTML += `
                <tr>
                    <td>${id}</td>
                    <td>${name}</td>
                    <td>${dept}</td>
                    <td>$${salary}</td>
                    <td class="actions">
                        <button class="btn-edit" onclick="editEmployee('${id}')">Edit</button>
                        <button class="btn-del" onclick="deleteEmployee('${id}')">Delete</button>
                    </td>
                </tr>`;
        }
    }
    function createEmployee() {
        const id = document.getElementById("empId").value;
        const name = document.getElementById("empName").value;
        const dept = document.getElementById("empDept").value;
        const salary = document.getElementById("empSalary").value;
        if (!id || !name) return showMsg("ID and Name are required", "error");
        const newEmp = xmlDoc.createElement("employee");
        const fields = { id, name, dept, salary };
        for (let key in fields) {
            const el = xmlDoc.createElement(key);
            el.textContent = fields[key];
            newEmp.appendChild(el);
        }

        xmlDoc.documentElement.appendChild(newEmp);
        displayTable();
        clearForm();
        showMsg("Employee added successfully", "success");
    }
    function deleteEmployee(id) {
        const employees = xmlDoc.getElementsByTagName("employee");
        for (let i = 0; i < employees.length; i++) {
            if (employees[i].getElementsByTagName("id")[0].textContent === id) {
                xmlDoc.documentElement.removeChild(employees[i]);
                break;
            }
        }
        displayTable();
        showMsg("Employee deleted", "success");
    }
    function editEmployee(id) {
        const employees = xmlDoc.getElementsByTagName("employee");
        for (let i = 0; i < employees.length; i++) {
            if (employees[i].getElementsByTagName("id")[0].textContent === id) {
                document.getElementById("empId").value = id;
                document.getElementById("empId").disabled = true;
                document.getElementById("empName").value = employees[i].getElementsByTagName("name")[0].textContent;
                document.getElementById("empDept").value = employees[i].getElementsByTagName("dept")[0].textContent;
                document.getElementById("empSalary").value = employees[i].getElementsByTagName("salary")[0].textContent;
                
                currentEditId = id;
                document.querySelector(".btn-add").style.display = "none";
                document.getElementById("saveBtn").style.display = "block";
                break;
            }
        }
    }
    function saveUpdate() {
        const employees = xmlDoc.getElementsByTagName("employee");
        for (let i = 0; i < employees.length; i++) {
            if (employees[i].getElementsByTagName("id")[0].textContent === currentEditId) {
                employees[i].getElementsByTagName("name")[0].textContent = document.getElementById("empName").value;
                employees[i].getElementsByTagName("dept")[0].textContent = document.getElementById("empDept").value;
                employees[i].getElementsByTagName("salary")[0].textContent = document.getElementById("empSalary").value;
                break;
            }
        }
        displayTable();
        clearForm();
        showMsg("Update successful", "success");
    }
    function clearForm() {
        document.querySelectorAll("input").forEach(input => input.value = "");
        document.getElementById("empId").disabled = false;
        document.querySelector(".btn-add").style.display = "block";
        document.getElementById("saveBtn").style.display = "none";
        currentEditId = null;
    }
    function showMsg(text, type) {
        const m = document.getElementById("msg");
        m.textContent = text;
        m.className = type;
        m.style.display = "block";
        setTimeout(() => m.style.display = "none", 3000);
    }
    window.onload = loadEmployees;
</script>
</body>
</html>