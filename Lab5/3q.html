<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Student Record System</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f4f4f9; padding: 20px; }
        .container { max-width: 900px; margin: auto; background: white; padding: 25px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .form-row { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 20px; }
        input { padding: 12px; border: 1px solid #ddd; border-radius: 5px; outline: none; }
        button { padding: 10px; cursor: pointer; border: none; border-radius: 5px; font-weight: bold; }
        .btn-create { background: #27ae60; color: white; grid-column: span 4; }
        .btn-update { background: #f39c12; color: white; display: none; grid-column: span 4; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 15px; border-bottom: 1px solid #eee; text-align: left; }
        th { background: #34495e; color: white; }
        .actions button { margin-right: 5px; color: white; }
        .btn-edit { background: #3498db; }
        .btn-delete { background: #e74c3c; }
        #msg { padding: 10px; margin-bottom: 15px; border-radius: 5px; display: none; text-align: center; }
        .error { background: #f8d7da; color: #721c24; }
        .success { background: #d4edda; color: #155724; }
    </style>
</head>
<body>
<div class="container">
    <h2>Student Record System</h2>
    <div id="msg"></div>

    <div class="form-row">
        <input type="text" id="stuId" placeholder="ID (e.g. S103)">
        <input type="text" id="stuName" placeholder="Full Name">
        <input type="text" id="stuCourse" placeholder="Course">
        <input type="number" id="stuMarks" placeholder="Marks">
        <button class="btn-create" onclick="addStudent()">Add Student</button>
        <button class="btn-update" id="updateBtn" onclick="saveUpdate()">Save Changes</button>
    </div>
    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Course</th>
                <th>Marks</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody id="studentTable"></tbody>
    </table>
</div>
<script>
    let studentData = [];
    let editIdx = null;

    async function fetchInitialData() {
        try {
            const response = await fetch('students.json');
            if (!response.ok) throw new Error("HTTP Error " + response.status);
            studentData = await response.json();
            renderTable();
        } catch (err) {
            showStatus("JSON Parsing Error: " + err.message, "error");
        }
    }
    function renderTable() {
        const tbody = document.getElementById('studentTable');
        tbody.innerHTML = '';
        studentData.forEach((student, index) => {
            tbody.innerHTML += `
                <tr>
                    <td>${student.id}</td>
                    <td>${student.name}</td>
                    <td>${student.course}</td>
                    <td>${student.marks}</td>
                    <td class="actions">
                        <button class="btn-edit" onclick="prepUpdate(${index})">Edit</button>
                        <button class="btn-delete" onclick="deleteRecord(${index})">Delete</button>
                    </td>
                </tr>`;
        });
    }
    function validate(id, name, course, marks) {
        if (!id || !name || !course || marks === "") {
            showStatus("All fields must be filled!", "error");
            return false;
        }
        if (marks < 0 || marks > 100) {
            showStatus("Marks must be between 0 and 100", "error");
            return false;
        }
        return true;
    }
    function addStudent() {
        const id = document.getElementById('stuId').value.trim();
        const name = document.getElementById('stuName').value.trim();
        const course = document.getElementById('stuCourse').value.trim();
        const marks = document.getElementById('stuMarks').value;
        if (!validate(id, name, course, marks)) return;
        if (studentData.some(s => s.id === id)) {
            return showStatus("ID already exists!", "error");
        }
        studentData.push({ id, name, course, marks: parseInt(marks) });
        renderTable();
        resetForm();
        showStatus("Student added successfully!", "success");
    }
    function deleteRecord(index) {
        if (confirm("Delete this record?")) {
            studentData.splice(index, 1);
            renderTable();
            showStatus("Record deleted", "success");
        }
    }
    function prepUpdate(index) {
        editIdx = index;
        const s = studentData[index];
        document.getElementById('stuId').value = s.id;
        document.getElementById('stuId').disabled = true;
        document.getElementById('stuName').value = s.name;
        document.getElementById('stuCourse').value = s.course;
        document.getElementById('stuMarks').value = s.marks;
        document.querySelector('.btn-create').style.display = 'none';
        document.getElementById('updateBtn').style.display = 'block';
    }
    function saveUpdate() {
        const name = document.getElementById('stuName').value.trim();
        const course = document.getElementById('stuCourse').value.trim();
        const marks = document.getElementById('stuMarks').value;
        if (!validate("bypass", name, course, marks)) return;
        studentData[editIdx].name = name;
        studentData[editIdx].course = course;
        studentData[editIdx].marks = parseInt(marks);
        renderTable();
        resetForm();
        showStatus("Record updated!", "success");
    }
    function resetForm() {
        document.querySelectorAll('input').forEach(i => i.value = '');
        document.getElementById('stuId').disabled = false;
        document.querySelector('.btn-create').style.display = 'block';
        document.getElementById('updateBtn').style.display = 'none';
        editIdx = null;
    }
    function showStatus(text, type) {
        const m = document.getElementById('msg');
        m.textContent = text;
        m.className = type;
        m.style.display = 'block';
        setTimeout(() => m.style.display = 'none', 3000);
    }
    window.onload = fetchInitialData;
</script>
</body>
</html>