<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shopping Cart</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f8f9fa; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .panel { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .product-item { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; padding: 10px; border-bottom: 1px solid #eee; }
        .cart-item { display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 0.9rem; }
        .discount-line { color: #28a745; font-size: 0.85rem; font-style: italic; }
        .total-section { margin-top: 20px; border-top: 2px solid #333; padding-top: 10px; }
        .coupon-box { margin-top: 15px; display: flex; gap: 5px; }
        button { cursor: pointer; padding: 5px 10px; border-radius: 4px; border: none; background: #007bff; color: white; }
        .remove-btn { background: #dc3545; padding: 2px 6px; }
        input[type="text"] { flex-grow: 1; padding: 5px; border: 1px solid #ccc; }
    </style>
</head>
<body>
<div class="container">
    <div class="panel">
        <h3>Products</h3>
        <div id="productList"></div>
    </div>
    <div class="panel">
        <h3>Your Cart</h3>
        <div id="cartItems"></div>
        <div class="coupon-box">
            <input type="text" id="couponInput" placeholder="Enter Code (e.g. SAVE10)">
            <button onclick="applyCoupon()">Apply</button>
        </div>
        <div class="total-section">
            <div id="summary"></div>
            <h4 id="grandTotal">Total: $0.00</h4>
        </div>
    </div>
</div>
<script>
    const products = [
        { id: 1, name: "Laptop", price: 1000, category: "Electronics" },
        { id: 2, name: "Headphones", price: 200, category: "Electronics" },
        { id: 3, name: "Notebook", price: 10, category: "Stationery" },
        { id: 4, name: "Desk Lamp", price: 50, category: "Home" }
    ];
    let cart = [];
    let activeCoupon = "";

    function renderProducts() {
        const list = document.getElementById('productList');
        list.innerHTML = products.map(p => `
            <div class="product-item">
                <span>${p.name} ($${p.price})</span>
                <button onclick="addToCart(${p.id})">Add</button>
            </div>
        `).join('');
    }
    function addToCart(id) {
        const product = products.find(p => p.id === id);
        const exists = cart.find(item => item.id === id);
        if (exists) {
            exists.quantity++;
        } else {
            cart.push({ ...product, quantity: 1 });
        }
        renderCart();
    }
    function updateQuantity(id, delta) {
        const item = cart.find(i => i.id === id);
        if (item) {
            item.quantity += delta;
            if (item.quantity <= 0) cart = cart.filter(i => i.id !== id);
        }
        renderCart();
    }
    function applyCoupon() {
        const input = document.getElementById('couponInput').value.trim().toUpperCase();
        if (input.startsWith("SAVE") && !isNaN(input.slice(4))) {
            activeCoupon = input;
        } else {
            alert("Invalid Coupon Format");
            activeCoupon = "";
        }
        renderCart();
    }
    function calculateTotals() {
        let subtotal = 0;
        let discounts = [];
        cart.forEach(item => {
            let itemTotal = item.price * item.quantity;
            subtotal += itemTotal;

            if (item.quantity >= 5) {
                const bulk = itemTotal * 0.1;
                discounts.push({ label: `Bulk Discount (10% off ${item.name})`, value: bulk });
            }

            if (item.category === "Electronics" && itemTotal > 500) {
                const techSaving = itemTotal * 0.05;
                discounts.push({ label: `Tech Promo (5% off ${item.name})`, value: techSaving });
            }
        });
        const hour = new Date().getHours();
        if (hour >= 20 || hour <= 5) {
            const nightShift = subtotal * 0.02;
            discounts.push({ label: "Night Owl Special (2%)", value: nightShift });
        }

        if (activeCoupon.startsWith("SAVE")) {
            const pct = parseInt(activeCoupon.slice(4));
            const couponVal = (subtotal - discounts.reduce((a, b) => a + b.value, 0)) * (pct / 100);
            discounts.push({ label: `Coupon ${activeCoupon}`, value: couponVal });
        }

        const totalDiscount = discounts.reduce((sum, d) => sum + d.value, 0);
        return { subtotal, discounts, final: subtotal - totalDiscount };
    }
    function renderCart() {
        const cartDiv = document.getElementById('cartItems');
        const summaryDiv = document.getElementById('summary');
        
        cartDiv.innerHTML = cart.map(item => `
            <div class="cart-item">
                <span>${item.name} (x${item.quantity})</span>
                <div>
                    <button onclick="updateQuantity(${item.id}, -1)">-</button>
                    <button onclick="updateQuantity(${item.id}, 1)">+</button>
                    <span>$${(item.price * item.quantity).toFixed(2)}</span>
                </div>
            </div>
        `).join('');
        const totals = calculateTotals();
        summaryDiv.innerHTML = `
            <div class="cart-item"><span>Subtotal:</span> <span>$${totals.subtotal.toFixed(2)}</span></div>
            ${totals.discounts.map(d => `
                <div class="cart-item discount-line">
                    <span>${d.label}:</span> <span>-$${d.value.toFixed(2)}</span>
                </div>
            `).join('')}
        `;
        document.getElementById('grandTotal').innerText = `Total: $${totals.final.toFixed(2)}`;
    }
    renderProducts();
</script>
</body>
</html>