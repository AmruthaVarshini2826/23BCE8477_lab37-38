<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Stage Workflow</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f0f2f5; display: flex; justify-content: center; padding: 40px; }
        .wizard-card { background: white; width: 500px; padding: 30px; border-radius: 12px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .progress-container { margin-bottom: 30px; background: #eee; height: 10px; border-radius: 5px; overflow: hidden; }
        #progressBar { height: 100%; width: 25%; background: #007bff; transition: width 0.3s ease; }
        .stage { display: none; }
        .active { display: block; }
        .field { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: 600; }
        input, select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; }
        .btn-group { display: flex; justify-content: space-between; margin-top: 25px; }
        button { padding: 10px 20px; border-radius: 6px; border: none; cursor: pointer; font-weight: bold; }
        .btn-next { background: #007bff; color: white; }
        .btn-prev { background: #6c757d; color: white; }
        .error { color: #dc3545; font-size: 0.8rem; margin-top: 5px; display: none; }
        input.invalid { border-color: #dc3545; background: #fff8f8; }
    </style>
</head>
<body>
<div class="wizard-card">
    <div class="progress-container"><div id="progressBar"></div></div>
    <form id="workflowForm">
        <div class="stage active" data-step="1">
            <h3>Step 1: Account Basics</h3>
            <div class="field">
                <label>Username</label>
                <input type="text" id="username" data-rules="required|min3">
                <div class="error">Username must be at least 3 characters.</div>
            </div>
        </div>
        <div class="stage" data-step="2">
            <h3>Step 2: Personal Details</h3>
            <div class="field">
                <label>Full Name</label>
                <input type="text" id="fullname" data-rules="required">
                <div class="error">Full name is required.</div>
            </div>
            <div class="field">
                <label>Birth Year</label>
                <input type="number" id="birthYear" data-rules="range1900-2010">
                <div class="error">Must be between 1900 and 2010.</div>
            </div>
        </div>
        <div class="stage" data-step="3">
            <h3>Step 3: Preferences</h3>
            <div class="field">
                <label>Communication</label>
                <select id="commPref" data-rules="required">
                    <option value="">Select...</option>
                    <option value="email">Email</option>
                    <option value="sms">SMS</option>
                </select>
                <div class="error">Please select a preference.</div>
            </div>
        </div>
        <div class="stage" data-step="4">
            <h3>Step 4: Confirmation</h3>
            <p>Please review your data before submitting.</p>
            <div id="summary"></div>
            <div class="field">
                <label><input type="checkbox" id="terms" data-rules="checked"> I agree to terms</label>
                <div class="error">You must agree to proceed.</div>
            </div>
        </div>
        <div class="btn-group">
            <button type="button" class="btn-prev" id="prevBtn" style="visibility: hidden;">Previous</button>
            <button type="button" class="btn-next" id="nextBtn">Next</button>
        </div>
    </form>
</div>
<script>
    let currentStep = 1;
    const totalSteps = 4;
    const formData = {};
    const validationLogic = {
        required: (val) => val.trim().length > 0,
        min3: (val) => val.trim().length >= 3,
        checked: (val, el) => el.checked,
        "range1900-2010": (val) => val >= 1900 && val <= 2010
    };
    function validateStage(step) {
        const stage = document.querySelector(`.stage[data-step="${step}"]`);
        const inputs = stage.querySelectorAll('input, select');
        let isStageValid = true;
        inputs.forEach(input => {
            const rules = input.dataset.rules ? input.dataset.rules.split('|') : [];
            let isInputValid = true;
            rules.forEach(rule => {
                if (!validationLogic[rule](input.value, input)) isInputValid = false;
            });
            const errorEl = input.closest('.field')?.querySelector('.error');
            if (!isInputValid) {
                input.classList.add('invalid');
                if (errorEl) errorEl.style.display = 'block';
                isStageValid = false;
            } else {
                input.classList.remove('invalid');
                if (errorEl) errorEl.style.display = 'none';
                formData[input.id] = input.type === 'checkbox' ? input.checked : input.value;
            }
        });
        return isStageValid;
    }
    function updateUI() {
        document.querySelectorAll('.stage').forEach(s => s.classList.remove('active'));
        document.querySelector(`.stage[data-step="${currentStep}"]`).classList.add('active');
        document.getElementById('progressBar').style.width = `${(currentStep / totalSteps) * 100}%`;
        document.getElementById('prevBtn').style.visibility = currentStep === 1 ? 'hidden' : 'visible';
        document.getElementById('nextBtn').innerText = currentStep === totalSteps ? 'Submit' : 'Next';
        if (currentStep === 4) {
            document.getElementById('summary').innerHTML = `
                <pre>${JSON.stringify(formData, null, 2)}</pre>
            `;
        }
    }
    document.getElementById('nextBtn').addEventListener('click', () => {
        if (validateStage(currentStep)) {
            if (currentStep < totalSteps) {
                currentStep++;
                updateUI();
            } else {
                alert('Workflow Complete! Data Saved.');
                console.log('Final Submission:', formData);
            }
        }
    });
    document.getElementById('prevBtn').addEventListener('click', () => {
        if (currentStep > 1) {
            currentStep--;
            updateUI();
        }
    });
</script>
</body>
</html>