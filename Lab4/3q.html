<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Student CRUD</title>
    <style>
        body { font-family: sans-serif; background: #f4f7f6; padding: 20px; }
        .container { max-width: 800px; margin: auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .form-group { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px; }
        input { padding: 10px; border: 1px solid #ddd; border-radius: 4px; }
        button { padding: 10px; cursor: pointer; border: none; border-radius: 4px; }
        .btn-add { background: #28a745; color: white; grid-column: span 2; }
        .btn-update { background: #ffc107; color: black; display: none; grid-column: span 2; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 12px; border: 1px solid #ddd; text-align: left; }
        th { background: #f8f9fa; }
        .btn-edit { background: #007bff; color: white; }
        .btn-del { background: #dc3545; color: white; }
        #message { padding: 10px; margin-bottom: 10px; border-radius: 4px; display: none; }
        .msg-success { background: #d4edda; color: #155724; }
        .msg-error { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
<div class="container">
    <h2>Student Management</h2>
    <div id="message"></div>
    <div class="form-group">
        <input type="text" id="stuId" placeholder="Student ID">
        <input type="text" id="stuName" placeholder="Full Name">
        <input type="text" id="stuDept" placeholder="Department">
        <input type="number" id="stuMarks" placeholder="Marks">
        <button class="btn-add" onclick="createStudent()">Add Student</button>
        <button class="btn-update" id="updateBtn" onclick="saveUpdate()">Save Changes</button>
    </div>
    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Dept</th>
                <th>Marks</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody id="studentTable"></tbody>
    </table>
</div>
<script>
    let students = [];
    const tableBody = document.getElementById('studentTable');
    const msgDiv = document.getElementById('message');
    let editIndex = null;
    async function loadStudents() {
        try {
            const response = await fetch('students.json');
            if (!response.ok) throw new Error(response.status); 
            students = await response.json();
            renderTable();
            showMsg("Data loaded", "success");
        } catch (err) {
            handleError(err);
        }
    }
    function renderTable() {
        tableBody.innerHTML = '';
        students.forEach((s, index) => {
            tableBody.innerHTML += `
                <tr>
                    <td>${s.id}</td>
                    <td>${s.name}</td>
                    <td>${s.dept}</td>
                    <td>${s.marks}</td>
                    <td>
                        <button class="btn-edit" onclick="editStudent(${index})">Edit</button>
                        <button class="btn-del" onclick="deleteStudent(${index})">Delete</button>
                    </td>
                </tr>`;
        });
    }
    function createStudent() {
        const id = document.getElementById('stuId').value;
        const name = document.getElementById('stuName').value;
        const dept = document.getElementById('stuDept').value;
        const marks = document.getElementById('stuMarks').value;
        if(!id || !name) return showMsg("ID and Name required", "error");
        students.push({ id, name, dept, marks });
        renderTable();
        clearForm();
        showMsg("Student added", "success");
    }
    function deleteStudent(index) {
        if(confirm("Delete this record?")) {
            students.splice(index, 1);
            renderTable();
            showMsg("Record deleted", "success");
        }
    }
    function editStudent(index) {
        editIndex = index;
        const s = students[index];
        document.getElementById('stuId').value = s.id;
        document.getElementById('stuName').value = s.name;
        document.getElementById('stuDept').value = s.dept;
        document.getElementById('stuMarks').value = s.marks;
        document.querySelector('.btn-add').style.display = 'none';
        document.getElementById('updateBtn').style.display = 'block';
    }
    function saveUpdate() {
        students[editIndex] = {
            id: document.getElementById('stuId').value,
            name: document.getElementById('stuName').value,
            dept: document.getElementById('stuDept').value,
            marks: document.getElementById('stuMarks').value
        };
        renderTable();
        clearForm();
        showMsg("Updated successfully", "success");
        document.querySelector('.btn-add').style.display = 'block';
        document.getElementById('updateBtn').style.display = 'none';
    }
    function clearForm() {
        document.querySelectorAll('input').forEach(i => i.value = '');
        editIndex = null;
    }
    function showMsg(text, type) {
        msgDiv.textContent = text;
        msgDiv.className = type === "success" ? "msg-success" : "msg-error";
        msgDiv.style.display = "block";
        setTimeout(() => msgDiv.style.display = "none", 3000);
    }
    function handleError(err) {
        const status = err.message;
        if(status === "404") showMsg("Error 404: File not found", "error");
        else if(status === "500") showMsg("Error 500: Server error", "error");
        else showMsg("Request failed: " + status, "error");
    }
    loadStudents();
</script>
</body>
</html>